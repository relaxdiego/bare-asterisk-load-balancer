---
all:
  vars:
    playbooks_running_in_lb1: true

    lb1_private_ip: 172.31.8.192
    lb1_private_int: eth0

    lb2_private_ip: 172.31.9.39
    lb2_private_int: eth0

    k8s1_private_ip: 172.31.14.118 
    k8s1_private_int: eth0

    k8s2_private_ip: 172.31.4.167 
    k8s2_private_int: eth0

    keepalived_external_vip_cidr: 54.179.84.86

    # https://docs.ansible.com/ansible/2.9/reference_appendices/interpreter_discovery.html
    ansible_python_interpreter: /usr/bin/python3

  hosts:
    lb1:
      ansible_host: "{{ lb1_private_ip }}"
      ansible_connection: "{{ 'local' if playbooks_running_in_lb1 else 'ssh' }}"
      keepalived_instances:
        external:
          interface: "{{ lb1_private_int }}"
          state: MASTER
          virtual_router_id: 10
          priority: 150
          advert_int: 1
          unicast_src_ip: "{{ lb1_private_ip }}"
          unicast_peers:
            - "{{ lb2_private_ip }}"
          vips:
            - "{{ keepalived_external_vip_cidr | default('127.0.2.1') }} dev {{ keepalived_external_interface | default('eth0') }}"
    lb2:
      ansible_host: "{{ lb2_private_ip }}"
      keepalived_instances:
        external:
          interface: "{{ lb2_private_int }}"
          state: BACKUP
          virtual_router_id: 10
          priority: 50
          advert_int: 1
          unicast_src_ip: "{{ lb2_private_ip }}"
          unicast_peers:
            - "{{ lb1_private_ip }}"
          vips:
            - "{{ keepalived_external_vip_cidr | default('127.0.2.1') }} dev {{ keepalived_external_interface | default('eth0') }}"
    k8s1:
      ansible_host: "{{ k8s1_private_ip }}"
    k8s2:
      ansible_host: "{{ k8s1_private_ip }}"

  children:
    load_balancers:
      hosts:
        lb1:
        lb2:
